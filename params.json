{"note":"Don't delete this file! It's used internally to help with page regeneration.","tagline":"Install chef-server from scratch using rvm and ruby 1.9.2","name":"Catering-college","google":"","body":"Install chef-server from scratch\r\n================================\r\n\r\nInstalling your own Chef server can be a bit hoop-jumpy. This abstracts all of those hoops into one (ugly) script which does all the jumping for you.\r\n\r\nWhat does it do?\r\n----------------\r\n\r\nChef server depends on a truckload of not-necessarily-easy-to-install things. We mostly follow [this](http://wiki.opscode.com/display/chef/Installing+Chef+Server+Manually) with a detour into RVM and Ruby 1.9.3.\r\n\r\nThe script:\r\n\r\n+ Installs CouchDB\r\n+ Installs and configures RabbitMQ (a more recent version than is in the Ubuntu repos)\r\n+ Installs Sun Java 1.6 (using [this witchcraft](https://github.com/flexiondotorg/oab-java6)) - THIS IS NOW BROKEN, SEE BELOW\r\n+ Installs OpsCode's Gecode\r\n+ Installs RVM\r\n+ Installs Ruby 1.9.3 (which isn't yet in the Ubuntu repos)\r\n+ Installs the Chef gems\r\n+ Configures the Chef server\r\n+ Creates upstart scripts for each of the Chef components\r\n+ Installs nginx to proxy the WebUI\r\n\r\nRegarding Java, the delightful people at Oracle, always the friends of free software, have moved the goalposts and the oab-java6 thing no longer works (UPDATE: I've had it working intermittently on a Vagrant box, and I've had it working recently on an EC2 node). I know people have come up with workarounds for this, but no doubt these will get stepped on soon, too. Life is too short to spend it trying to outwit lawyer-driven corporations, so it now tests if Java is already installed, and if not, installs OpenJDK (which seems to work OK for me).\r\n\r\nThese steps are mostly idempotent.\r\n\r\nHow to use it\r\n-------------\r\n\r\nDead-simple install:\r\n\r\n    sudo apt-get install -y curl ; bash <(curl -s https://raw.github.com/pikesley/catering-college/master/bootstrapper) \r\n\r\nWhat the above is actually doing: we create a new user (I've used 'chef') and add them to the 'admin' group (the shortest path to sudo happiness, at least on Ubuntu). Then, as this new user, checkout and run the script.\r\n\r\n    NEWUSER=chef\r\n    sudo useradd -m ${NEWUSER} -s /bin/bash\r\n    cat /etc/group | sed \"s/^\\(admin:.*\\)/\\1,${NEWUSER}/\" > /tmp/group && sudo mv /tmp/group /etc/\r\n    sudo apt-get update\r\n    sudo apt-get install -y git-core\r\n\r\n    sudo su - ${NEWUSER} \r\n\r\n    git clone https://github.com/pikesley/catering-college\r\n    cd catering-college\r\n    ./install-chef-server\r\n\r\nThere's a trick here: `visudo`, then change this line:\r\n\r\n    %admin ALL=(ALL) ALL\r\n\r\nto\r\n\r\n    %admin ALL=(ALL) NOPASSWD: ALL\r\n\r\nto allow members of the 'admin' group to sudo without a password. You may not want to do this, of course.\r\n\r\nCaveats\r\n-------\r\n\r\n+ I've tested this to death on an Ubuntu Lucid VM. I suspect it'll probably work on other Debian-ish platforms. It's also known to work on Precise.\r\n+ The configuration step for chef-solr assumes there's no data in there that we care about (which is obviously true for a new installation), and nukes the whole thing. There may be ways around this, but I don't know how Solr works and I really have no desire to.\r\n\r\n"}